## 0. Introduction
This tool can convert ```point cloud``` and ```trajectory``` generated by any LiDAR odometry (such as [FAST-LIO2](https://github.com/hku-mars/FAST_LIO), [PV-LIO](https://github.com/HViktorTsoi/PV-LIO), [Point-LIO](https://github.com/hku-mars/Point-LIO.git), etc.) into the ```map``` format required by [interactive_slam](https://github.com/koide3/interactive_slam). It also provides preprocessing operations such as keyframe filtering, point cloud downsampling, and point cloud merging. interactive_slam is an excellent semi-automatic map optimization tool.

### Contributors
[Yihao Xu 许益豪](https://github.com/liaraaaaaaa), [Xin Li 李鑫](https://github.com/carlos-lee123), [Zhongxia Zhao 赵仲夏](https://github.com/xiaranqing)

## 1. Prerequisites
### 1.1 **Ubuntu** and **ROS**
The following processes have been tested in a pure Ubuntu 18.04 virtual machine.


### 1.2. **PCL && Eigen**
The PCL library provided by ROS is sufficient. Additionally, install the following dependencies:
```
sudo apt-get install ros-{your-ros-version, e.g., melodic}-pcl-ros 
```
To install Eigen:
```
sudo apt-get install libeigen3-dev
```

### 1.3. **GL3W && GLFW**
These are mainly used for visualization purposes.

Install them with the following command:
```
sudo apt-get install libglm-dev libglfw3-dev
```

### 1.4. **g2o**
This is mainly used for interactive_slam.

Install **g2o** from source:
```
git clone https://github.com/RainerKuemmerle/g2o.git
cd g2o
mkdir build 
cd build
cmake ../
make
sudo make install
```

#### issue 1：
During the installation of **g2o**, you might encounter an issue with an outdated version of cmake.
```
CMake 3.14 or higher is required.  You are running version 3.10.2
```
Upgrading cmake to version 3.20.0 solves the problem.

#### issue 2：
During the installation of **g2o**, you might encounter issues related to the filesystem header. Upgrading gcc and g++ to gcc-9 and g++-9 solves the issue.

#### issue 3：
While running the program, you might encounter errors indicating that some g2o libraries (e.g., libg2o_stuff.so) cannot be found. To resolve this, add the following path to the file `/etc/ld.so.conf`.
```
/usr/local/lib
```
Then run the following command:
```
sudo ldconfig
```

## 2. Build
Create a `build` folder:
```
mkdir build
```
Run the `compile.sh` script for each building.
```
./compile.sh
```
## 3. Running without Visualization Interface 
Run the `run.sh` script:
```
./run.sh
```
All parameters can be modified in the `./config/config.json` file specified in `run.sh`. For example:
```
{
    // `true` means reading odometry data from a rosbag file, `false` means reading from an odometry folder
    "from_rosbag": true,
    // Path to the rosbag
    "bag_path": "/xx/xxx.bag",
    // Path to the odometry folder
    "odom_directory": "/xx/xxx",
    // Downsampling resolution
    "downsample_resolution": 0.1,
    // `false` means no downsampling, `true` means downsampling
    "is_downsample": false,
    // Keyframe distance threshold in meters
    "keyframe_delta_x": 10,
    // Keyframe angle threshold in degrees
    "keyframe_delta_angle": 90,
    // Number of neighboring keyframes (n). Note: n frames before and after are taken, so the total is n * 2
    "friends_num": 20,
    // 0 means saving as an interactive SLAM map, 1 means saving as a station map
    "save_mode": 0,
    // Path to save the map
    "save_path": "/yy/yyy"
}
```
The formats for ROSbag, odometry folder, and map can be found on the [wiki](https://github.com/deepglint/LIO2InteractiveSLAM/wiki/LIO2InteractiveSLAM-Guide).

## 4. Running with Visualization Interface 
Run the `interactive_interface.sh` script:
```
./interactive_interface.sh
```
For detailed operations of the visualization interface, refer to the [wiki](https://github.com/deepglint/LIO2InteractiveSLAM/wiki/LIO2InteractiveSLAM-Guide).
